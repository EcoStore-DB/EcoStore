<div class="container mt-5">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-4 mb-4">
      <div class="list-group shadow-sm rounded">
        <button class="list-group-item list-group-item-action d-flex align-items-center justify-content-between"
          [class.active]="activeTab === 'config'" (click)="activeTab = 'config'">
          Configuraciones
          <i class="fa-solid fa-gear"></i>
        </button>
        <button class="list-group-item list-group-item-action d-flex align-items-center justify-content-between"
          [class.active]="activeTab === 'seguimiento'" (click)="activeTab = 'seguimiento'">
          Seguimiento de Pedido
          <i class="fa-solid fa-truck"></i>
        </button>
        <button class="list-group-item list-group-item-action d-flex align-items-center justify-content-between"
          [class.active]="activeTab === 'productos'"
          (click)="activeTab = 'productos'">
          Gestión de Productos
          <i class="fa-solid fa-box"></i>
        </button>
        <button class="list-group-item list-group-item-action d-flex align-items-center justify-content-between"
          [class.active]="activeTab === 'ventas'" (click)="activeTab = 'ventas'">
          Ventas por producto
          <i class="fa-solid fa-chart-column"></i>
        </button>
        <button class="list-group-item list-group-item-action d-flex align-items-center justify-content-between"
          [class.active]="activeTab === 'productosPorCategoria'" (click)="activeTab = 'productosPorCategoria'">
          Productos por categoría
          <i class="fa-solid fa-layer-group"></i>
        </button>
      </div>
    </div>

    <!-- Content -->
    <div class="col-md-8">
      <div [ngSwitch]="activeTab">

        <!-- Configuraciones -->
        <div *ngSwitchCase="'config'">
          <div class="card shadow-sm border-0">
            <div class="card-body">
              <h4 class="card-title mb-4 text-success">Configuraciones</h4>
              <form>
                <div class="mb-4">
                  <label for="nombre" class="form-label fw-semibold">Nombre</label>
                  <input type="text" class="form-control form-control-lg" id="nombre" placeholder="Tu nombre">
                </div>
                <div class="mb-4">
                  <label for="email" class="form-label fw-semibold">Correo electrónico</label>
                  <input type="email" class="form-control form-control-lg" id="email"
                    placeholder="correo@ejemplo.com">
                </div>
                <div class="mt-4 my-5 py-5">
                  <button type="submit" class="btn btn-success btn-lg px-3 me-3">Guardar Cambios</button>
                  <button type="button" class="btn btn-danger btn-lg px-3">Cerrar Sesión</button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Seguimiento de Pedido -->
        <div *ngSwitchCase="'seguimiento'">
          <div class="card shadow-sm border-0">
            <div class="card-body">
              <h4 class="card-title mb-4 text-success">Seguimiento de Pedido</h4>
              <form class="mb-4" (ngSubmit)="buscarProductoPorId()">
                <div class="mb-3">
                  <label for="pedido" class="form-label fw-semibold">ID del producto</label>
                  <input type="number" class="form-control form-control-lg" id="pedido" placeholder="Ej: 1" [(ngModel)]="idBusqueda" name="idBusqueda" required>
                </div>
                <button type="submit" class="btn btn-primary btn-lg px-4">Buscar</button>
              </form>

              <!-- Resultado de la búsqueda -->
              <div *ngIf="productoBuscado">
                <div class="alert alert-success rounded-3 shadow-sm">
                  <p><strong>Nombre:</strong> {{ productoBuscado.nombre }}</p>
                  <p><strong>Precio:</strong> {{ productoBuscado.precio | currency }}</p>
                  <p><strong>Categoría:</strong> {{ productoBuscado.categoria }}</p>
                </div>
              </div>
              <div *ngIf="busquedaFallida" class="alert alert-danger rounded-3 shadow-sm">
                Producto no encontrado.
              </div>
            </div>
          </div>
        </div>

        <!-- Gestión de Productos -->
        <div *ngSwitchCase="'productos'">
          <div class="card shadow-sm border-0">
            <div class="card-body">
              <h4 class="card-title mb-4 text-success">Gestión de Productos</h4>

              <!-- Formulario para agregar producto -->
              <form (ngSubmit)="agregarProducto()" #form="ngForm">
                <div class="row mb-4">
                  <div class="col-md-4">
                    <label class="form-label fw-semibold">Nombre del producto</label>
                    <input type="text" class="form-control" [(ngModel)]="nuevoProducto.nombre" name="nombre"
                      required>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label fw-semibold">Precio</label>
                    <input type="number" class="form-control" [(ngModel)]="nuevoProducto.precio" name="precio"
                      required>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label fw-semibold">Categoría</label>
                    <select class="form-select" [(ngModel)]="nuevoProducto.categoria" name="categoria" required>
                      <option value="" disabled selected>Selecciona una categoría</option>
                      <option *ngFor="let cat of categoriasPermitidas" [value]="cat">{{ cat }}</option>
                    </select>
                  </div>
                </div>
                <button type="submit" class="btn btn-success btn-lg" [disabled]="form.invalid">Agregar Producto</button>
              </form>

              <hr class="my-4">

              <!-- Lista de productos -->
              <div *ngIf="productos.length > 0; else sinProductos">
                <div class="table-responsive">
                  <table class="table table-bordered align-middle mb-0">
                    <thead class="table-light">
                      <tr>
                        <th style="width: 80px;">ID</th>
                        <th>Nombre</th>
                        <th>Precio</th>
                        <th style="width: 180px;">Acciones</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let producto of productos | slice:0:productosVisibles; let i = index">
                        <td>
                          <span class="badge bg-secondary px-3 py-2 fs-6">{{ producto.id_producto }}</span>
                        </td>
                        <td>
                          <input type="text" class="form-control" [(ngModel)]="producto.nombre" name="nombre-{{i}}">
                        </td>
                        <td>
                          <input type="number" class="form-control" [(ngModel)]="producto.precio" name="precio-{{i}}">
                        </td>
                        <td>
                          <div class="btn-group w-100" role="group">
                            <button class="btn btn-primary btn-sm" (click)="actualizarProducto(i)">
                              <i class="fa-solid fa-pen-to-square"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" (click)="eliminarProducto(i)">
                              <i class="fa-solid fa-trash"></i>
                            </button>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <!-- Botón cargar más -->
                <div class="text-center py-3">
                  <button class="btn btn-outline-primary" (click)="cargarMasProductos()" [disabled]="productosVisibles >= productos.length">
                    Cargar más
                  </button>
                  <div *ngIf="productosVisibles >= productos.length" class="text-muted mt-2" style="font-size: 0.95em;">
                    Ya no hay más productos para mostrar.
                  </div>
                </div>
              </div>

              <ng-template #sinProductos>
                <p class="text-muted fst-italic">No hay productos agregados aún.</p>
              </ng-template>
            </div>
          </div>
        </div>

        <!-- Ventas por producto -->
        <div *ngSwitchCase="'ventas'">
          <div class="card shadow-sm border-0 mt-4">
            <div class="card-body">
              <h4 class="card-title mb-4 text-success">Ventas por producto</h4>
              <ngx-charts-bar-vertical
                [results]="ventasPorProducto"
                [xAxis]="true"
                [yAxis]="true"
                [legend]="false"
                [showXAxisLabel]="true"
                [showYAxisLabel]="true"
                xAxisLabel="Producto"
                yAxisLabel="Ventas"
                [roundEdges]="true">
              </ngx-charts-bar-vertical>
            </div>
          </div>
        </div>

        <!-- Productos por categoría -->
        <div *ngSwitchCase="'productosPorCategoria'">
          <div class="card shadow-sm border-0 mt-4">
            <div class="card-body">
              <h4 class="card-title mb-4 text-success">Productos por categoría</h4>
              <ngx-charts-bar-vertical
                [results]="productosPorCategoria"
                scheme="vivid"
                [xAxis]="true"
                [yAxis]="true"
                [legend]="false"
                [showXAxisLabel]="true"
                [showYAxisLabel]="true"
                xAxisLabel="Categoría"
                yAxisLabel="Cantidad"
                [roundEdges]="true">
              </ngx-charts-bar-vertical>
            </div>
          </div>
        </div>

        <!-- Default -->
        <div *ngSwitchDefault>
          <p class="text-muted fst-italic">Selecciona una opción del menú.</p>
        </div>

      </div>
    </div>
  </div>
</div>
